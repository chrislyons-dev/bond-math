{
  "version": "1.0",
  "project": {
    "name": "bond-math",
    "description": "Multi-language, serverless microservices system for fixed-income pricing and metrics",
    "repository": "https://github.com/chrislyons-dev/bond-math.git"
  },
  "services": [
    {
      "id": "bond-valuation",
      "name": "Bond Valuation",
      "type": "cloudflare-worker-python",
      "layer": "business-logic",
      "description": "Price â†” yield calculations and cashflow generation for bullet bonds",
      "owner": "platform-team",
      "internalRoutes": ["/price", "/yield", "/health"],
      "dependencies": ["svc-daycount"],
      "securityModel": "internal-jwt",
      "slaTier": "high",
      "endpoints": [
        {
          "method": "POST",
          "path": "/price",
          "gatewayRoute": "POST /api/valuation/v1/price",
          "authentication": "internal-jwt",
          "scope": "valuation:write"
        },
        {
          "method": "POST",
          "path": "/yield",
          "gatewayRoute": "POST /api/valuation/v1/yield",
          "authentication": "internal-jwt",
          "scope": "valuation:write"
        }
      ]
    },
    {
      "id": "daycount",
      "name": "Daycount",
      "type": "cloudflare-worker-typescript",
      "layer": "business-logic",
      "description": "Authoritative day-count and year-fraction calculations for fixed income",
      "owner": "platform-team",
      "sourcePath": "C:\\Users\\chris\\git\\bond-math\\services\\daycount",
      "internalRoutes": ["/count", "/health"],
      "dependencies": [],
      "securityModel": "internal-jwt",
      "slaTier": "high",
      "endpoints": []
    },
    {
      "id": "gateway",
      "name": "Gateway",
      "type": "cloudflare-worker-typescript",
      "layer": "api-gateway",
      "description": "Entry point for all API traffic - handles Auth0 verification, internal JWT minting, and service routing",
      "owner": "platform-team",
      "sourcePath": "C:\\Users\\chris\\git\\bond-math\\services\\gateway",
      "internalRoutes": ["/health", "/api/*"],
      "dependencies": ["svc-daycount", "svc-valuation", "svc-metrics", "svc-pricing"],
      "securityModel": "auth0-oidc",
      "slaTier": "critical",
      "endpoints": []
    },
    {
      "id": "metrics",
      "name": "Metrics",
      "type": "cloudflare-worker-python",
      "layer": "business-logic",
      "description": "Bond risk metrics (duration, convexity, PV01, DV01)",
      "owner": "platform-team",
      "internalRoutes": ["/duration", "/convexity", "/risk", "/health"],
      "dependencies": ["svc-bond-valuation"],
      "securityModel": "internal-jwt",
      "slaTier": "high",
      "endpoints": [
        {
          "method": "POST",
          "path": "/duration",
          "gatewayRoute": "POST /api/metrics/v1/duration",
          "authentication": "internal-jwt",
          "scope": "metrics:write"
        },
        {
          "method": "POST",
          "path": "/convexity",
          "gatewayRoute": "POST /api/metrics/v1/convexity",
          "authentication": "internal-jwt",
          "scope": "metrics:write"
        },
        {
          "method": "POST",
          "path": "/risk",
          "gatewayRoute": "POST /api/metrics/v1/risk",
          "authentication": "internal-jwt",
          "scope": "metrics:write"
        }
      ]
    },
    {
      "id": "pricing",
      "name": "Pricing",
      "type": "cloudflare-worker-python",
      "layer": "business-logic",
      "description": "Curve-based cashflow discounting and present value calculations",
      "owner": "platform-team",
      "internalRoutes": ["/value", "/scenario", "/key-rate", "/health"],
      "dependencies": [],
      "securityModel": "internal-jwt",
      "slaTier": "high",
      "endpoints": [
        {
          "method": "POST",
          "path": "/value",
          "gatewayRoute": "POST /api/pricing/v1/value",
          "authentication": "internal-jwt",
          "scope": "pricing:write"
        },
        {
          "method": "POST",
          "path": "/scenario",
          "gatewayRoute": "POST /api/pricing/v1/scenario",
          "authentication": "internal-jwt",
          "scope": "pricing:write"
        },
        {
          "method": "POST",
          "path": "/key-rate",
          "gatewayRoute": "POST /api/pricing/v1/key-rate",
          "authentication": "internal-jwt",
          "scope": "pricing:write"
        }
      ]
    }
  ],
  "relationships": [
    {
      "source": "gateway",
      "destination": "bond-valuation",
      "protocol": "service-binding",
      "authentication": "internal-jwt",
      "binding": "SVC_VALUATION"
    },
    {
      "source": "gateway",
      "destination": "daycount",
      "protocol": "service-binding",
      "authentication": "internal-jwt",
      "binding": "SVC_DAYCOUNT"
    },
    {
      "source": "gateway",
      "destination": "metrics",
      "protocol": "service-binding",
      "authentication": "internal-jwt",
      "binding": "SVC_METRICS"
    },
    {
      "source": "gateway",
      "destination": "pricing",
      "protocol": "service-binding",
      "authentication": "internal-jwt",
      "binding": "SVC_PRICING"
    }
  ],
  "components": [
    {
      "id": "daycount.ActorClaim",
      "name": "ActorClaim",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nActor claim from internal JWT\nRepresents \"Service X acting for User Y\"",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "iss",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "sub",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "role",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "perms",
          "type": "string[]",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "org",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "uid",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DateComponents",
      "name": "DateComponents",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nParsed date components for calculations\n",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "year",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "month",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "day",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DatePair",
      "name": "DatePair",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nDate pair for year fraction calculation",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "start",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "end",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DayCountOptions",
      "name": "DayCountOptions",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nOptions for day-count calculations",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "eomRule",
          "type": "boolean",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "frequency",
          "type": "number",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DayCountRequest",
      "name": "DayCountRequest",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nRequest body for /api/daycount/v1/count endpoint",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "pairs",
          "type": "DatePair[]",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "convention",
          "type": "DayCountConvention",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "options",
          "type": "DayCountOptions",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "version",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DayCountResponse",
      "name": "DayCountResponse",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nResponse body for /api/daycount/v1/count endpoint",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "results",
          "type": "DayCountResult[]",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "convention",
          "type": "DayCountConvention",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "version",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.DayCountResult",
      "name": "DayCountResult",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nSingle day-count calculation result",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "days",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "yearFraction",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "basis",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.Env",
      "name": "Env",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nCloudflare Worker environment bindings",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "INTERNAL_JWT_SECRET",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "ENVIRONMENT",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.ErrorResponse",
      "name": "ErrorResponse",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nStandard error response following RFC 7807 Problem Details",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "type",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "title",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "status",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "detail",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "instance",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "errors",
          "type": "Array<{\n    field?: string;\n    message: string;\n  }>",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.ValidationError",
      "name": "ValidationError",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nValidation error with field context",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "field",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "message",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "daycount.Variables",
      "name": "Variables",
      "serviceId": "daycount",
      "type": "interface",
      "description": "\nHono context variables",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "requestId",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "actor",
          "type": "ActorClaim",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.ActorClaim",
      "name": "ActorClaim",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nActor claim - represents \"Service X acting for User Y\"",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "iss",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "sub",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "role",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "perms",
          "type": "string[]",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "org",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "uid",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.Auth0Claims",
      "name": "Auth0Claims",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nAuth0 JWT claims (after verification)",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "iss",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "sub",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "aud",
          "type": "string | string[]",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "exp",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "iat",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "scope",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "permissions",
          "type": "string[]",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "'https://bondmath.chrislyons.dev/role'",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "'https://bondmath.chrislyons.dev/permissions'",
          "type": "string[]",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "'https://bondmath.chrislyons.dev/user_id'",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "'https://bondmath.chrislyons.dev/org_id'",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.Env",
      "name": "Env",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nType definitions for Gateway Worker",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "AUTH0_DOMAIN",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "AUTH0_AUDIENCE",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "INTERNAL_JWT_SECRET",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "INTERNAL_JWT_TTL",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "ENVIRONMENT",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "SVC_DAYCOUNT",
          "type": "Fetcher",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "SVC_VALUATION",
          "type": "Fetcher",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "SVC_METRICS",
          "type": "Fetcher",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "SVC_PRICING",
          "type": "Fetcher",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.ErrorResponse",
      "name": "ErrorResponse",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nRFC 7807 Problem Details error response",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "type",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "title",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "status",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "detail",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "instance",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.InternalJWT",
      "name": "InternalJWT",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nInternal JWT payload structure",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "iss",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "sub",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "aud",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "exp",
          "type": "number",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "rid",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "act",
          "type": "ActorClaim",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.JWK",
      "name": "JWK",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nJSON Web Key structure",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "kty",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "use",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "kid",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "n",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "e",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "alg",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "x5c",
          "type": "string[]",
          "isOptional": true,
          "isReadonly": false
        },
        {
          "name": "x5t",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.JWKS",
      "name": "JWKS",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nAuth0 JWKS response structure",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "keys",
          "type": "JWK[]",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.ServiceRoute",
      "name": "ServiceRoute",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nService route mapping",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "prefix",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "binding",
          "type": "keyof Env",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "stripPrefix",
          "type": "boolean",
          "isOptional": false,
          "isReadonly": false
        }
      ],
      "methods": []
    },
    {
      "id": "gateway.Variables",
      "name": "Variables",
      "serviceId": "gateway",
      "type": "interface",
      "description": "\nHono context variables",
      "excludeFromDiagram": false,
      "properties": [
        {
          "name": "requestId",
          "type": "string",
          "isOptional": false,
          "isReadonly": false
        },
        {
          "name": "userId",
          "type": "string",
          "isOptional": true,
          "isReadonly": false
        }
      ],
      "methods": []
    }
  ],
  "componentRelationships": [
    {
      "source": "daycount.DayCountRequest",
      "destination": "daycount.DatePair",
      "technology": "Uses"
    },
    {
      "source": "daycount.DayCountRequest",
      "destination": "daycount.DayCountOptions",
      "technology": "Uses"
    },
    {
      "source": "daycount.DayCountResponse",
      "destination": "daycount.DayCountResult",
      "technology": "Uses"
    },
    {
      "source": "daycount.Variables",
      "destination": "daycount.ActorClaim",
      "technology": "Uses"
    },
    {
      "source": "gateway.InternalJWT",
      "destination": "gateway.ActorClaim",
      "technology": "Uses"
    },
    {
      "source": "gateway.JWKS",
      "destination": "gateway.JWK",
      "technology": "Uses"
    }
  ],
  "deploymentEnvironments": [
    {
      "name": "development",
      "deploymentNodes": [
        {
          "id": "gateway-development",
          "name": "bond-math-gateway-dev",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-gateway-dev",
            "routes": []
          },
          "containerInstances": ["gateway"]
        }
      ]
    },
    {
      "name": "preview",
      "deploymentNodes": [
        {
          "id": "gateway-preview",
          "name": "bond-math-gateway-preview",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-gateway-preview",
            "routes": []
          },
          "containerInstances": ["gateway"]
        },
        {
          "id": "daycount-preview",
          "name": "bond-math-daycount-preview",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-daycount-preview",
            "routes": []
          },
          "containerInstances": ["daycount"]
        },
        {
          "id": "bond-valuation-preview",
          "name": "bond-math-valuation-preview",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-valuation-preview",
            "routes": []
          },
          "containerInstances": ["bond-valuation"]
        },
        {
          "id": "metrics-preview",
          "name": "bond-math-metrics-preview",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-metrics-preview",
            "routes": []
          },
          "containerInstances": ["metrics"]
        },
        {
          "id": "pricing-preview",
          "name": "bond-math-pricing-preview",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-pricing-preview",
            "routes": []
          },
          "containerInstances": ["pricing"]
        }
      ]
    },
    {
      "name": "production",
      "deploymentNodes": [
        {
          "id": "gateway-production",
          "name": "bond-math-gateway",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-gateway",
            "routes": []
          },
          "containerInstances": ["gateway"]
        },
        {
          "id": "daycount-production",
          "name": "bond-math-daycount",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-daycount",
            "routes": []
          },
          "containerInstances": ["daycount"]
        },
        {
          "id": "bond-valuation-production",
          "name": "bond-math-valuation",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-valuation",
            "routes": []
          },
          "containerInstances": ["bond-valuation"]
        },
        {
          "id": "metrics-production",
          "name": "bond-math-metrics",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-metrics",
            "routes": []
          },
          "containerInstances": ["metrics"]
        },
        {
          "id": "pricing-production",
          "name": "bond-math-pricing",
          "type": "container",
          "technology": "Cloudflare Workers",
          "properties": {
            "workerName": "bond-math-pricing",
            "routes": []
          },
          "containerInstances": ["pricing"]
        }
      ]
    }
  ]
}
